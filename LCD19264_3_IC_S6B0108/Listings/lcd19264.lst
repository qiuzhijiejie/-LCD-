C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD19264
OBJECT MODULE PLACED IN .\Objects\lcd19264.obj
COMPILER INVOKED BY: D:\KEIL_STM32\C51\BIN\C51.EXE lcd19264.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\lcd19264.lst) OBJECT(.\Objects\lcd19264.obj)

line level    source

   1          #include <INTRINS.H>    
   2          #include <STDIO.H>     
   3          #include <MATH.H>    
   4          #include <ABSACC.H>    
   5          #include <REG52.H>  
   6          #include "lcd19264.h"
   7          #include "picture.h"
   8          
   9          sbit RS  =P3^0;    
  10          sbit RW  =P3^1;     
  11          sbit E   =P3^2;     
  12          sbit CSB =P3^3;    
  13          sbit CSA =P3^4;    
  14          sbit RES =P3^5; 
  15          bit  Log =0;  
  16          sbit int0=P2^1;
  17          sbit KEY=P2^0;
  18          
  19          unsigned char Page;     
  20          unsigned char Col;  
  21           
  22          
  23          
  24          void BusyL(void)   
  25          {
  26   1          unsigned char flag = 0xFF; 
  27   1          
  28   1      
  29   1          CSB = 0;  
  30   1          CSA = 0;   
  31   1          RS = 0;    
  32   1          RW = 1;   
  33   1          P1 = 0xFF; 
  34   1      
  35   1          while ((flag & 0x80) == 0x80)
  36   1          {
  37   2              E = 1;    
  38   2              _nop_();     
  39   2              flag = P1;   
  40   2              E = 0;       
  41   2          }
  42   1      }
  43          
  44          
  45          void BusyM(void)   
  46          {
  47   1          unsigned char flag = 0xFF; 
  48   1      
  49   1          
  50   1          CSB = 0;   
  51   1          CSA = 1;   
  52   1          RS = 0;   
  53   1          RW = 1;    
  54   1      
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 2   

  55   1          P1 = 0xFF;
  56   1      
  57   1      
  58   1      
  59   1      
  60   1          while ((flag & 0x80) == 0x80)
  61   1          {
  62   2              E = 1;      
  63   2      
  64   2              _nop_();    
  65   2      
  66   2              flag = P1;   
  67   2      
  68   2              E = 0;       
  69   2              }
  70   1      }
  71             
  72          
  73            
  74          void BusyR(void)   
  75          {
  76   1              unsigned char  flag=0xff; 
  77   1              CSB= 1;   
  78   1              CSA= 0;     
  79   1              RS = 0;    
  80   1              RW = 1;   
  81   1              P1 = 0xFF;   
  82   1              while ((flag&0x80)==0x80)
  83   1              {
  84   2                      E=1;
  85   2                      _nop_();
  86   2                      flag=P1;
  87   2                      E=0;
  88   2              }  
  89   1      }   
  90             
  91             
  92          
  93          void Locatexy(void)   
  94          {   
  95   1               unsigned char x,y;   
  96   1               switch (Col&0xc0) /*  col.and.0xC0 */   
  97   1               {    
  98   2                        case 0: {BusyL();break;}  
  99   2                        case 0x40: {BusyM();break;}  
 100   2                        case 0x80: {BusyR();break;} 
 101   2               }   
 102   1               x = Col&0x3F|0x40; /* col.and.0x3f.or.Set X Address*/   
 103   1               y = Page&0x07|0xB8; /* row.and.0x07.or.set Page */   
 104   1                 
 105   1               RS = 0;      
 106   1               RW = 0;      
 107   1               P1 = y;  
 108   1               E  = 1;   
 109   1               _nop_();   
 110   1               E  = 0;   
 111   1               _nop_();   
 112   1               
 113   1               RS = 0;   
 114   1               RW = 0;   
 115   1               P1 = x;      
 116   1               E  = 1;   
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 3   

 117   1               _nop_();   
 118   1               E  = 0;   
 119   1               _nop_(); 
 120   1       
 121   1      
 122   1      }   
 123          
 124          //1-64    
 125          void WriteCommandL( unsigned char CommandByte )   
 126          {   
 127   1               BusyL();   
 128   1               P1 = CommandByte;   
 129   1               RS = 0;   
 130   1               RW = 0;   
 131   1               E  = 1;   
 132   1               _nop_();   
 133   1               E  = 0;   
 134   1               _nop_();   
 135   1      }   
 136          
 137          // 65-128      
 138          void WriteCommandM( unsigned char CommandByte )   
 139          {   
 140   1               BusyM();   
 141   1               P1 = CommandByte;   
 142   1               RS = 0;    
 143   1               RW = 0;   
 144   1               E  = 1;   
 145   1               _nop_();   
 146   1               E  = 0;   
 147   1               _nop_();   
 148   1      }   
 149          
 150          //129-192    
 151          void WriteCommandR( unsigned char CommandByte )   
 152          {   
 153   1               BusyR();   
 154   1               P1 = CommandByte;   
 155   1               RS = 0;   
 156   1               RW = 0;   
 157   1               E  = 1;   
 158   1               _nop_();   
 159   1               E  = 0;   
 160   1               _nop_();   
 161   1      }   
 162             
 163          
 164          /*Read data  */   
 165          unsigned char ReadData( void )   
 166          {   
 167   1               unsigned char DataByte;   
 168   1               Locatexy();   
 169   1               RS = 1;    
 170   1               RW = 1;  
 171   1               P1 = 0xFF;  
 172   1                _nop_();   
 173   1               
 174   1               E  = 1;    
 175   1               _nop_();   
 176   1      
 177   1               DataByte = P1;  
 178   1               E  = 0;   
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 4   

 179   1               _nop_();  
 180   1               CSB=1;
 181   1               CSA=1;
 182   1               return DataByte;   
 183   1      }   
 184             
 185          
 186          
 187          
 188           
 189          /*Write data   */   
 190          void WriteData( unsigned char DataByte )   
 191          {   
 192   1               Locatexy();   
 193   1               RS = 1;    
 194   1               RW = 0;     
 195   1               P1 = DataByte; 
 196   1               E  = 1;    
 197   1               _nop_();   
 198   1               E  = 0;   
 199   1               _nop_(); 
 200   1               CSB=1;
 201   1               CSA=1;
 202   1      }   
 203          
 204          
 205             
 206          void LcmClear( void )   
 207          {   
 208   1               Page = 0;   
 209   1               Col  = 0;   
 210   1               for(Page=0;Page<8;Page++)   
 211   1                for(Col=0;Col<192;Col++)   
 212   1                 WriteData(0);   
 213   1      }   
 214          
 215            
 216          void LcmInit( void )   
 217          {       RES=0; 
 218   1              Delay(10);
 219   1          RES=1;
 220   1      
 221   1               WriteCommandL(0x3f); //DISPALY ON
 222   1               WriteCommandM(0x3f);   
 223   1               WriteCommandR(0x3f);   
 224   1                 
 225   1               WriteCommandL(0xc0); //SET START ADDRESS  
 226   1               WriteCommandM(0xc0);   
 227   1               WriteCommandR(0xc0);   
 228   1                 
 229   1               WriteCommandL(0x3f); //DISPLAY ON  
 230   1               WriteCommandM(0x3f);   
 231   1               WriteCommandR(0x3f);   
 232   1                       
 233   1      }   
 234             
 235          void LcmPutDots( unsigned char DotByte,unsigned char DotByte1 )   
 236          {   
 237   1               Page = 0;   
 238   1               Col  = 0;   
 239   1               for(Page=0;Page<8;Page++)   
 240   1               {   
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 5   

 241   2                        for(Col=0;Col<192;Col++)   
 242   2                        {   
 243   3                                 WriteData( DotByte );
 244   3                                 Col++;
 245   3                                 WriteData( DotByte1 );  
 246   3                        } 
 247   2                      
 248   2               }   
 249   1      }   
 250             
 251          void LcmPutBMP( unsigned char *puts )   
 252          {   
 253   1               unsigned int X=0;   
 254   1               Page = 0;   
 255   1               Col  = 0;   
 256   1               for(Page=0;Page<8;Page++)   
 257   1               {   
 258   2                        for(Col=0;Col<192;Col++)   
 259   2                        {   
 260   3                                 WriteData( puts[X] );   
 261   3                                 X++;   
 262   3                        }   
 263   2               }   
 264   1      }   
 265             
 266          void LcmReverseBMP( void )   
 267          {   
 268   1       unsigned char temp;   
 269   1               Page = 0;   
 270   1               Col  = 0;   
 271   1               for(Page=0;Page<8;Page++)   
 272   1               {   
 273   2                        for(Col=0;Col<192;Col++)   
 274   2                        {   
 275   3                                 temp = ReadData();   
 276   3      
 277   3                                 temp = ReadData();   
 278   3                                 temp = ~temp;   
 279   3                                 WriteData(temp);   
 280   3                        }   
 281   2               }   
 282   1      }   
 283          
 284          void Display_8_8(unsigned char C[],unsigned char i)
 285          { 
 286   1               unsigned char k,num=0;
 287   1               num=i*0x08;
 288   1               for(k=0;k<0x08;k++)
 289   1               {
 290   2                        WriteData(C[num+k]);
 291   2                        Col+=0x01;
 292   2               } 
 293   1      
 294   1      }
 295          
 296          
 297          void Display_16_16(unsigned char F[],unsigned char i)
 298          {
 299   1               unsigned char k=0;
 300   1               unsigned int num=0;
 301   1               num=i*0x20;
 302   1      
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 6   

 303   1               for(k=0;k<0x10;k++)
 304   1               {
 305   2                        WriteData(F[num+k]);
 306   2                        Col+=0x01;
 307   2               } 
 308   1                Col-=0x10;
 309   1                Page+=0x01;   
 310   1                for(k=16;k<0x20;k++)
 311   1               {
 312   2                        WriteData(F[num+k]);
 313   2                        Col+=0x01;
 314   2               } 
 315   1                Page-=0x01; 
 316   1                Delay(10); 
 317   1      }
 318          
 319          void Display_character()
 320          { 
 321   1              unsigned char k,c, a=0;
 322   1               Col  = 0;
 323   1               for(c=0;c<8;c++)
 324   1               { 
 325   2                       Page = c; 
 326   2                      for(k=0;k<24;k++)
 327   2                      { 
 328   3                              Display_8_8(character,0);
 329   3                      }
 330   2                Col  = 0;
 331   2               }
 332   1                Delay(100);
 333   1      
 334   1               for(c=0;c<8;c++)
 335   1               { Page = c; 
 336   2                      for(k=0;k<24;k++)
 337   2                      { 
 338   3                              Display_8_8(character,1);
 339   3                      }
 340   2                Col  = 0;
 341   2               }
 342   1                Delay(100);
 343   1      
 344   1               for(c=0;c<8;c++)
 345   1               { Page = c; 
 346   2                      for(k=0;k<24;k++)
 347   2                      { 
 348   3                              Display_8_8(character,2);
 349   3                      }
 350   2                Col  = 0;
 351   2               }
 352   1                Delay(100);
 353   1      
 354   1      
 355   1      }
 356          
 357          
 358          
 359          void Display_Chinese()
 360          {
 361   1              unsigned char a=0;
 362   1      //       Page = 0;   
 363   1      //       Col  = 0;
 364   1      //       for(a=0;a<12;a++)
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 7   

 365   1      //       {
 366   1      //         Display_16_16(font,a);
 367   1      //       }
 368   1      //       Page = 2;   
 369   1      //       Col  = 0;
 370   1      //       for(a=12;a<24;a++)
 371   1      //       {
 372   1      //              Display_16_16(font,a);
 373   1      //       }
 374   1      
 375   1      //       Page = 4;   
 376   1      //       Col  = 0;
 377   1      //       for(a=24;a<36;a++)
 378   1      //       {
 379   1      //              Display_16_16(font,a);
 380   1      //       }
 381   1      
 382   1      //       Page = 6;   
 383   1      //       Col  = 0;
 384   1      //       for(a=36;a<48;a++)
 385   1      //      {
 386   1      //              Display_16_16(font,a);
 387   1      //       }
 388   1      
 389   1      
 390   1       Page = 1;   
 391   1       Col  = 16;
 392   1       for(a=0;a<10;a++)
 393   1       {
 394   2         Display_16_16(font,a);
 395   2       }
 396   1       
 397   1       Page = 4;   
 398   1       Col  = 16;
 399   1       for(a=10;a<20;a++)
 400   1       {
 401   2         Display_16_16(font,a);
 402   2       }
 403   1      
 404   1      }
 405           
 406          void Delay(unsigned int MS)   
 407          {   
 408   1               unsigned char us,usn;   
 409   1               while(MS!=0)   
 410   1               {   
 411   2                usn = 2; //for 12M    
 412   2                while(usn!=0)   
 413   2                {   
 414   3                         us=0xf6;   
 415   3                         while (us!=0){us--;};   
 416   3                         usn--;   
 417   3                }   
 418   2                      MS--;   
 419   2               }  
 420   1               while(Log);
 421   1      }   
 422          
 423          
 424          
 425          void Step(void) interrupt 0 using 0
 426          { _nop_(); 
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 8   

 427   1        _nop_(); 
 428   1        _nop_();
 429   1        _nop_();
 430   1        _nop_();
 431   1        _nop_();
 432   1        _nop_();
 433   1        _nop_();
 434   1        _nop_();
 435   1        _nop_();
 436   1        _nop_();
 437   1        _nop_();
 438   1        _nop_();
 439   1        _nop_();
 440   1        _nop_();
 441   1        _nop_();
 442   1        _nop_();
 443   1        _nop_();
 444   1        _nop_();
 445   1        _nop_(); 
 446   1        _nop_(); 
 447   1        _nop_();
 448   1        _nop_();
 449   1        _nop_();
 450   1        _nop_();
 451   1        _nop_();
 452   1        _nop_();
 453   1        _nop_();
 454   1        _nop_();
 455   1        _nop_();
 456   1        _nop_();
 457   1        _nop_();
 458   1        _nop_();
 459   1        _nop_();
 460   1        _nop_();
 461   1        _nop_();
 462   1        _nop_();
 463   1        _nop_();
 464   1              if(int0==0)
 465   1              Log=!Log;
 466   1          while(!int0);
 467   1        return;
 468   1      
 469   1      }
 470          
 471          
 472          unsigned char key()
 473          {
 474   1          if (KEY == 0) 
 475   1          {
 476   2              Delay(1);  
 477   2              if (KEY == 0) 
 478   2              {
 479   3                  while (KEY == 0);
 480   3                  return 1; 
 481   3              }
 482   2          }
 483   1          return 0; 
 484   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    848    ----
C51 COMPILER V9.60.7.0   LCD19264                                                          11/19/2024 16:57:01 PAGE 9   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
